{% extends "user_base.html" %}

{% block title %}{{ quiz.title }}{% endblock %}

{% block content %}
<div class="container">
    <h2>{{ quiz.title }}</h2>
    <p><strong>Chapter:</strong> {{ quiz.chapter.name }}</p>
    <p><strong>Subject:</strong> {{ quiz.chapter.subject.name }}</p>

    <form id="quiz-form">
        <input type="hidden" name="quiz_id" value="{{ quiz.id }}">

        {% for question in questions %}
        <div class="mb-4">
            <p><strong>{{ question.question_text }}</strong></p>
            {% for key, value in question.get_options().items() %}
            <div class="form-check">
                <input class="form-check-input" type="radio" name="question_{{ question.id }}" value="{{ key }}">
                <label class="form-check-label">{{ key }}. {{ value }}</label>
            </div>
            {% endfor %}
        </div>
        {% endfor %}

        <button type="submit" class="btn btn-success">Submit Quiz</button>
    </form>
</div>

<script>
    document.getElementById('quiz-form').addEventListener('submit', function (event) {
        event.preventDefault();

        // Confirmation popup
        if (!confirm("Are you sure you want to submit the quiz?")) {
            return;
        }

        let formData = new FormData(event.target);

        fetch("{{ url_for('views.submit_quiz') }}", {
            method: "POST",
            body: formData  // No need for JSON.stringify or setting headers
        })
            .then(response => response.json())
            .then(data => {
                if (data.success) {
                    alert(data.message + " Your Score: " + data.score);
                    window.location.href = "{{ url_for('views.dashboard') }}";
                } else {
                    alert("Error: " + data.message);
                }
            })
            .catch(error => console.error("Error:", error));
    });

</script>
{% endblock %}